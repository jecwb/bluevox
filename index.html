<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#00ff00">
    <meta name="description" content="Repert√≥rio de m√∫sicas - BlueVox">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Repert√≥rio BlueVox</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --cor-primaria: #00ff00;
            --cor-secundaria: #00aa00;
            --cor-fundo: #000000;
            --cor-texto: #00ff00;
            --cor-destaque: #ffff00;
            --cor-laranja: #ff8800;
            --cor-botao: #003300;
            --cor-hover: #004400;
        }
        
        body {
            background: var(--cor-fundo);
            color: var(--cor-texto);
            font-family: Arial, sans-serif;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            flex: 1;
            width: 100%;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--cor-primaria);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            text-shadow: 0 0 10px var(--cor-primaria);
            color: var(--cor-primaria);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: #111111;
            border: 2px dashed var(--cor-secundaria);
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .empty-state h2 {
            color: var(--cor-primaria);
            margin-bottom: 12px;
            font-size: 1.3rem;
        }
        
        .empty-state p {
            color: var(--cor-secundaria);
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .music-list {
            margin: 20px 0;
            width: 100%;
        }
        
        .music-item {
            background: #111111;
            border: 1px solid var(--cor-secundaria);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
        }
        
        .music-item:hover {
            background: #1a1a1a;
            border-color: var(--cor-primaria);
            transform: translateX(5px);
        }
        
        .music-name {
            color: var(--cor-primaria);
            font-size: 1.1rem;
            font-weight: bold;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 15px;
        }
        
        .music-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .action-btn {
            background: var(--cor-botao);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-secundaria);
            width: 35px;
            height: 35px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .action-btn:hover {
            background: var(--cor-hover);
            transform: scale(1.1);
        }
        
        .edit-btn {
            background: #003366;
            border-color: #0066cc;
        }
        
        .delete-btn {
            background: #660000;
            border-color: #ff4444;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
            width: 100%;
        }
        
        .btn {
            background: var(--cor-botao);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-secundaria);
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: var(--cor-hover);
            transform: translateY(-2px);
        }
        
        .btn-add {
            background: #006600;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .btn-secondary {
            background: #333333;
            border-color: #666666;
        }
        
        .btn-install {
            background: #004477;
            border-color: #0088ff;
            font-weight: bold;
        }
        
        .music-count {
            text-align: center;
            color: var(--cor-secundaria);
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 8px;
            background: #111;
            border-radius: 5px;
            border: 1px solid var(--cor-secundaria);
        }
        
        .update-alert {
            background: #003366;
            border: 1px solid #0088ff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        .update-alert h3 {
            color: #00ffff;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .update-alert p {
            color: #00ccff;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--cor-fundo);
            margin: 0;
            padding: 0;
            border: none;
            border-radius: 0;
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 5px 10px;
            background: #111;
            border-bottom: 1px solid var(--cor-primaria);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-title-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }
        
        .modal-header h2 {
            color: var(--cor-primaria);
            font-size: 0.8rem;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .separator {
            color: var(--cor-secundaria);
            font-size: 0.8rem;
            margin: 0 3px;
        }
        
        .font-controls-header {
            display: flex;
            gap: 3px;
            align-items: center;
        }
        
        .font-btn {
            background: var(--cor-botao);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-secundaria);
            width: 24px;
            height: 24px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .font-btn:hover {
            background: var(--cor-hover);
        }
        
        .scroll-controls {
            display: flex;
            gap: 3px;
            align-items: center;
            margin-left: 5px;
        }
        
        .scroll-btn {
            background: var(--cor-botao);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-secundaria);
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            white-space: nowrap;
        }
        
        .scroll-btn:hover {
            background: var(--cor-hover);
        }
        
        .scroll-btn.active {
            background: var(--cor-primaria);
            color: var(--cor-fundo);
        }
        
        .scroll-speed-controls {
            display: flex;
            gap: 3px;
            align-items: center;
            margin-left: 5px;
        }
        
        .speed-btn {
            background: var(--cor-botao);
            color: var(--cor-primaria);
            border: 1px solid var(--cor-secundaria);
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.6rem;
            min-width: 20px;
        }
        
        .speed-btn:hover {
            background: var(--cor-hover);
        }
        
        .speed-btn.active {
            background: var(--cor-primaria);
            color: var(--cor-fundo);
        }
        
        .close {
            color: var(--cor-primaria);
            font-size: 16px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 2px;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 3px;
        }
        
        .modal-body {
            height: calc(100vh - 40px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .lyrics-content {
            line-height: 1.6;
            white-space: pre-wrap;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            text-align: center;
            font-size: 16px;
            padding: 20px 15px;
            min-height: calc(100vh - 40px);
            margin: 0;
            box-sizing: border-box;
            color: var(--cor-texto);
            transition: font-size 0.3s ease;
        }

        .yellow-line {
            color: var(--cor-destaque) !important;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.3);
        }
        
        .normal-line {
            margin: 8px 0;
            color: var(--cor-texto);
        }
        
        .laranja {
            color: #ff8800 !important;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 136, 0, 0.3);
        }
        
        .add-form, .edit-form, .config-form {
            background: #111;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--cor-secundaria);
            max-width: 600px;
            margin: 20px auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--cor-primaria);
            font-weight: bold;
            font-size: 1rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            background: var(--cor-fundo);
            border: 1px solid var(--cor-secundaria);
            border-radius: 5px;
            color: var(--cor-texto);
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--cor-primaria);
            box-shadow: 0 0 8px var(--cor-primaria);
        }
        
        .form-textarea {
            height: 400px;
            resize: vertical;
            font-family: Arial, sans-serif;
            line-height: 1.4;
            white-space: pre-wrap;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--cor-secundaria);
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .color-option {
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.05);
        }
        
        .color-option.active {
            border-color: var(--cor-primaria);
        }
        
        .success {
            color: var(--cor-primaria);
            background: #003300;
            border-radius: 8px;
            border: 1px solid var(--cor-primaria);
            padding: 12px;
            text-align: center;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .install-prompt {
            background: #003300;
            border: 1px solid var(--cor-primaria);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        .backup-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
            margin: 15px 0;
            width: 100%;
        }
        
        .backup-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        
        .backup-info {
            text-align: center;
            color: var(--cor-secundaria);
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .import-option {
            background: #111;
            border: 1px solid var(--cor-secundaria);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .import-option:hover {
            background: #1a1a1a;
            border-color: var(--cor-primaria);
        }
        
        .import-option.selected {
            background: #003300;
            border-color: var(--cor-primaria);
        }
        
        .import-option h3 {
            color: var(--cor-primaria);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .import-option p {
            color: var(--cor-secundaria);
            font-size: 0.8rem;
            margin: 0;
        }
        
        @keyframes pulse {
            0% { border-color: var(--cor-primaria); }
            50% { border-color: var(--cor-destaque); }
            100% { border-color: var(--cor-primaria); }
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .music-item { padding: 12px 15px; }
            .music-name { font-size: 1rem; }
            .action-btn { width: 32px; height: 32px; font-size: 0.8rem; }
            .controls { flex-direction: column; }
            .btn { width: 100%; padding: 14px 16px; }
            .modal-header { padding: 5px 8px; }
            .font-btn, .scroll-btn, .speed-btn { transform: scale(0.9); }
            .backup-options { flex-direction: column; }
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .music-item { padding: 10px 12px; }
            .music-name { font-size: 0.9rem; }
            .action-btn { width: 30px; height: 30px; font-size: 0.75rem; }
            .form-actions { flex-direction: column; }
            .lyrics-content { font-size: 14px; padding: 15px 10px; }
            .modal-header { flex-wrap: wrap; gap: 5px; }
            .modal-title-container { min-width: 100px; }
            .btn { padding: 16px 20px; font-size: 1rem; }
        }
        
        @media (max-width: 400px) {
            .modal-header { padding: 5px 5px; }
            .font-controls-header, .scroll-controls, .scroll-speed-controls { 
                transform: scale(0.8); 
            }
            .btn { padding: 18px 16px; font-size: 0.95rem; }
        }

        /* Novos estilos para layout melhorado */
        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 10px 0;
        }

        .section-title {
            color: var(--cor-primaria);
            font-size: 1.1rem;
            margin: 15px 0 8px 0;
            text-align: center;
            border-bottom: 1px solid var(--cor-secundaria);
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>REPERT√ìRIO BLUEVOX</h1>
        </header>
        
        <div id="update-alert" class="update-alert" style="display: none;">
            <h3>üîÑ ATUALIZA√á√ÉO DISPON√çVEL!</h3>
            <p>H√° uma nova vers√£o do repert√≥rio dispon√≠vel.</p>
            <button class="btn" onclick="mostrarOpcoesUpdate()">
                üîÑ Fazer Update do Repert√≥rio
            </button>
        </div>
        
        <div id="install-prompt" class="install-prompt" style="display: none;">
            <strong>üí° Para melhor experi√™ncia:</strong><br>
            Adicione este app √† tela inicial do seu celular!
            <button class="btn btn-install" onclick="instalarApp()" style="margin-top: 10px;">
                üì± Instalar App Agora
            </button>
            <div style="margin-top: 10px; font-size: 0.8rem; color: #00cc00;">
                ‚ö° Acesso r√°pido ‚ö° Sem internet ‚ö° Totalmente offline
            </div>
        </div>
        
        <div id="music-count" class="music-count" style="display: none;"></div>
        
        <div id="empty-state" class="empty-state">
            <h2>üéµ Bem-vindo ao Repert√≥rio BlueVox!</h2>
            <p>Gerencie seu repert√≥rio musical de forma pr√°tica e offline</p>
            
            <div style="display: flex; flex-direction: column; gap: 10px; align-items: center; margin-top: 20px;">
                <button class="btn btn-add" onclick="mostrarFormulario()">
                    ‚ûï Adicionar Primeira M√∫sica
                </button>
                
                <div style="color: #00aa00; margin: 10px 0;">ou</div>
                
                <div class="backup-options">
                    <div class="backup-option">
                        <div class="file-input-wrapper">
                            <button class="btn">
                                üì• Importar Backup
                            </button>
                            <input type="file" id="file-input-initial" accept=".xml" style="display: none;" onchange="iniciarImportacao(event)">
                        </div>
                    </div>
                    <div class="backup-option">
                        <button class="btn" onclick="mostrarImportacaoURL()">
                            üåê Importar de URL
                        </button>
                    </div>
                    <div class="backup-option">
                        <button class="btn" onclick="mostrarOpcoesUpdate()">
                            üîÑ Update do Repert√≥rio
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 25px; padding: 15px; background: #111; border-radius: 8px; border: 1px solid #00aa00;">
                <strong style="color: #00ff00;">‚ú® Dicas:</strong>
                <ul style="text-align: left; margin-top: 10px; color: #00cc00; padding-left: 20px;">
                    <li>Use <strong>[R]</strong> no in√≠cio das linhas para destaque em amarelo</li>
                    <li>Use <strong>|texto|</strong> para mostrar <strong>[texto]</strong> em laranja</li>
                    <li>Adicione √† tela inicial para acesso r√°pido</li>
                    <li>Todos os dados ficam salvos no seu navegador</li>
                    <li>Backup √∫nico em formato XML universal</li>
                    <li>Importe de arquivo local ou URL remota</li>
                </ul>
            </div>
        </div>
        
        <div id="music-list" class="music-list" style="display: none;"></div>
        
        <div id="controls" class="controls" style="display: none;">
            <div class="controls-section">
                <button class="btn btn-add" onclick="mostrarFormulario()">
                    ‚ûï Adicionar M√∫sica
                </button>
            </div>

            <div class="section-title">BACKUP E DADOS</div>
            
            <div class="backup-options">
                <button class="btn" onclick="exportarDados()">
                    üì§ Exportar Backup
                </button>
                
                <div class="file-input-wrapper">
                    <button class="btn">
                        üì• Importar Backup
                    </button>
                    <input type="file" id="file-input" accept=".xml" style="display: none;" onchange="iniciarImportacao(event)">
                </div>
                
                <button class="btn" onclick="mostrarImportacaoURL()">
                    üåê Importar de URL
                </button>
                
                <button class="btn" onclick="mostrarOpcoesUpdate()">
                    üîÑ Update do Repert√≥rio
                </button>
            </div>

            <div class="section-title">CONFIGURA√á√ïES</div>
            
            <div class="backup-options">
                <button class="btn" onclick="mostrarConfiguracoes()">
                    üé® Cores
                </button>
                
                <button class="btn" onclick="resetarAplicativo()">
                    üóëÔ∏è Resetar App
                </button>
                
                <button class="btn btn-install" onclick="instalarApp()" id="install-btn">
                    üì± Instalar App
                </button>
                
                <button class="btn" onclick="mostrarAjuda()">
                    ‚ùì Ajuda
                </button>
            </div>
        </div>
    </div>

    <footer class="footer" style="text-align: center; margin-top: 40px; padding: 20px 0; border-top: 1px solid #00aa00; color: #00cc00;">
        <div class="copyright">¬© 2024 BlueVox - Repert√≥rio - By Jeferson</div>
    </footer>

    <!-- MODAL DA LETRA -->
    <div id="music-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-container">
                    <h2 id="modal-title">T√çTULO DA M√öSICA</h2>
                    <span class="separator">-</span>
                    <div class="font-controls-header">
                        <button class="font-btn" onclick="ajustarFonte(-2)" title="Diminuir fonte">A-</button>
                        <button class="font-btn" onclick="ajustarFonte(0)" title="Fonte padr√£o">A</button>
                        <button class="font-btn" onclick="ajustarFonte(2)" title="Aumentar fonte">A+</button>
                    </div>
                    <div class="scroll-controls">
                        <button class="scroll-btn" id="scroll-toggle" onclick="toggleAutoScroll()" title="Auto Scroll">‚ñ∂Ô∏è Scroll</button>
                    </div>
                    <div class="scroll-speed-controls" id="speed-controls" style="display: none;">
                        <button class="speed-btn" onclick="setScrollSpeed(1)" title="Muito Muito Lento">üêå</button>
                        <button class="speed-btn" onclick="setScrollSpeed(2)" title="Muito Lento">üê¢üê¢</button>
                        <button class="speed-btn" onclick="setScrollSpeed(3)" title="Lento">üê¢</button>
                        <button class="speed-btn" onclick="setScrollSpeed(4)" title="Normal-Lento">üö∂üê¢</button>
                        <button class="speed-btn" onclick="setScrollSpeed(5)" title="Normal">üö∂</button>
                        <button class="speed-btn" onclick="setScrollSpeed(6)" title="R√°pido">üèÉ</button>
                        <button class="speed-btn" onclick="setScrollSpeed(7)" title="Muito R√°pido">‚ö°</button>
                    </div>
                </div>
                <button class="close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="lyrics-content" class="lyrics-content"></div>
            </div>
        </div>
    </div>

    <!-- MODAL ADICIONAR M√öSICA -->
    <div id="add-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï ADICIONAR NOVA M√öSICA</h2>
                <button class="close" onclick="fecharAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-form" class="add-form" onsubmit="adicionarMusica(event)">
                    <div class="form-group">
                        <label for="nome-musica">NOME DA M√öSICA:</label>
                        <input type="text" id="nome-musica" class="form-input" required placeholder="Ex: REINO DOS RATOS">
                    </div>
                    
                    <div class="form-group">
                        <label for="letra-musica">LETRA DA M√öSICA:</label>
                        <textarea id="letra-musica" class="form-input form-textarea" required 
                                  placeholder="Cole aqui a letra completa...

Exemplo:
[R] ESTE √â O REINO DOS RATOS, √â PARAR OU SEGUIR
[R] POR ENTRE RUAS E BECOS, UM LABIRINTO √Ä DESCOBRIR
NA ESCURID√ÉO DO POR√ÉO, O SOL N√ÉO VAI ENTRAR
CHEIRO DE MOFO E LIXO, SINTO TABACO NO AR

üí° Use [R] no in√≠cio das linhas que devem aparecer em AMARELO
üí° Use |Bm| para mostrar [Bm] em LARANJA"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharAddModal()">Cancelar</button>
                        <button type="submit" class="btn btn-add">üíæ Salvar M√∫sica</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL EDITAR M√öSICA -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è EDITAR M√öSICA</h2>
                <button class="close" onclick="fecharEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-form" class="edit-form" onsubmit="editarMusica(event)">
                    <input type="hidden" id="edit-index">
                    <div class="form-group">
                        <label for="edit-nome-musica">NOME DA M√öSICA:</label>
                        <input type="text" id="edit-nome-musica" class="form-input" required placeholder="Ex: REINO DOS RATOS">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-letra-musica">LETRA DA M√öSICA:</label>
                        <textarea id="edit-letra-musica" class="form-input form-textarea" required 
                                  placeholder="Cole aqui a letra completa...

Exemplo:
[R] ESTE √â O REINO DOS RATOS, √â PARAR OU SEGUIR
[R] POR ENTRE RUAS E BECOS, UM LABIRINTO √Ä DESCOBRIR
NA ESCURID√ÉO DO POR√ÉO, O SOL N√ÉO VAI ENTRAR
CHEIRO DE MOFO E LIXO, SINTO TABACO NO AR

üí° Use [R] no in√≠cio das linhas que devem aparecer em AMARELO
üí° Use |Bm| para mostrar [Bm] em LARANJA"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharEditModal()">Cancelar</button>
                        <button type="submit" class="btn btn-add">üíæ Atualizar M√∫sica</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIGURA√á√ïES -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üé® CONFIGURA√á√ïES DE CORES</h2>
                <button class="close" onclick="fecharConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form class="config-form">
                    <div class="form-group">
                        <label>SELECIONE UM TEMA:</label>
                        <div class="color-options">
                            <div class="color-option active" data-theme="green" 
                                 style="background: #000000; color: #00ff00; border: 1px solid #00ff00;"
                                 onclick="aplicarTema('green')">
                                üü¢ Verde Neon
                            </div>
                            <div class="color-option" data-theme="blue"
                                 style="background: #000033; color: #0088ff; border: 1px solid #0088ff;"
                                 onclick="aplicarTema('blue')">
                                üîµ Azul Tech
                            </div>
                            <div class="color-option" data-theme="red"
                                 style="background: #330000; color: #ff4444; border: 1px solid #ff4444;"
                                 onclick="aplicarTema('red')">
                                üî¥ Vermelho
                            </div>
                            <div class="color-option" data-theme="purple"
                                 style="background: #1a001a; color: #cc00ff; border: 1px solid #cc00ff;"
                                 onclick="aplicarTema('purple')">
                                üü£ Roxo
                            </div>
                            <div class="color-option" data-theme="orange"
                                 style="background: #331900; color: #ff8800; border: 1px solid #ff8800;"
                                 onclick="aplicarTema('orange')">
                                üü† Laranja
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharConfigModal()">Fechar</button>
                        <button type="button" class="btn" onclick="resetarTema()">üîÑ Tema Padr√£o</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL OP√á√ïES DE IMPORTAR -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì• OP√á√ïES DE IMPORTAR</h2>
                <button class="close" onclick="fecharImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="padding: 20px; max-width: 600px; margin: 0 auto;">
                    <div class="form-group">
                        <label>ENCONTRADAS <span id="import-count">0</span> M√öSICA(S) NO BACKUP</label>
                        <p style="color: var(--cor-secundaria); margin-bottom: 20px;">
                            Selecione como deseja importar as m√∫sicas:
                        </p>
                        
                        <div class="import-options">
                            <div class="import-option" onclick="selecionarOpcaoImport('substituir')" id="option-substituir">
                                <h3>üîÑ SUBSTITUIR TUDO</h3>
                                <p>Remove todas as m√∫sicas atuais e importa apenas as do backup</p>
                            </div>
                            
                            <div class="import-option" onclick="selecionarOpcaoImport('adicionar')" id="option-adicionar">
                                <h3>‚ûï ADICIONAR NOVAS</h3>
                                <p>Mant√©m as m√∫sicas atuais e adiciona apenas as que n√£o existem</p>
                            </div>
                            
                            <div class="import-option" onclick="selecionarOpcaoImport('mesclar')" id="option-mesclar">
                                <h3>üîÑ MESCLAR TUDO</h3>
                                <p>Combina todas as m√∫sicas, atualizando as existentes e adicionando novas</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharImportModal()">Cancelar</button>
                        <button type="button" class="btn btn-add" onclick="confirmarImportacao()" id="confirm-import-btn" disabled>
                            üíæ Confirmar Importa√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL IMPORTAR VIA URL -->
    <div id="import-url-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üåê IMPORTAR DE URL</h2>
                <button class="close" onclick="fecharImportURLModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form class="config-form" onsubmit="importarDeURL(event)">
                    <div class="form-group">
                        <label for="url-xml">URL DO ARQUIVO XML:</label>
                        <input type="url" id="url-xml" class="form-input" required 
                               placeholder="Ex: http://teste.com.br/musicas.xml"
                               pattern="https?://.+" title="Digite uma URL v√°lida come√ßando com http:// ou https://">
                        <p style="color: var(--cor-secundaria); margin-top: 8px; font-size: 0.8rem;">
                            üí° A URL deve apontar para um arquivo XML v√°lido do Repert√≥rio BlueVox
                        </p>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharImportURLModal()">Cancelar</button>
                        <button type="submit" class="btn btn-add">üì• Importar da URL</button>
                    </div>
                </form>
                
                <div id="url-loading" style="display: none; text-align: center; padding: 20px;">
                    <div style="color: var(--cor-primaria); margin-bottom: 10px;">‚è≥ Carregando dados da URL...</div>
                    <div style="color: var(--cor-secundaria); font-size: 0.8rem;">
                        Aguarde enquanto buscamos o arquivo XML
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL UPDATE DO REPERT√ìRIO -->
    <div id="update-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ UPDATE DO REPERT√ìRIO</h2>
                <button class="close" onclick="fecharUpdateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="padding: 20px; max-width: 600px; margin: 0 auto;">
                    <div class="form-group">
                        <label>ENCONTRADAS <span id="update-count">0</span> M√öSICA(S) NO REPERT√ìRIO ONLINE</label>
                        <p style="color: var(--cor-secundaria); margin-bottom: 20px;">
                            Selecione como deseja atualizar o repert√≥rio:
                        </p>
                        
                        <div class="import-options">
                            <div class="import-option" onclick="selecionarOpcaoUpdate('substituir')" id="update-option-substituir">
                                <h3>üîÑ SUBSTITUIR TUDO</h3>
                                <p>Remove todas as m√∫sicas atuais e importa apenas as do repert√≥rio online</p>
                            </div>
                            
                            <div class="import-option" onclick="selecionarOpcaoUpdate('mesclar')" id="update-option-mesclar">
                                <h3>üîÑ MESCLAR TUDO</h3>
                                <p>Combina todas as m√∫sicas, atualizando as existentes e adicionando novas</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="fecharUpdateModal()">Cancelar</button>
                        <button type="button" class="btn btn-add" onclick="confirmarUpdate()" id="confirm-update-btn" disabled>
                            üíæ Confirmar Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO
        let musicas = [];
        let deferredPrompt = null;
        let tamanhoFonteBase = 16;
        let autoScrollAtivo = false;
        let scrollInterval = null;
        let scrollSpeed = 5;
        
        // Vari√°veis para controle de importa√ß√£o
        let dadosImportacao = null;
        let opcaoImportSelecionada = null;
        let importacaoURLEmAndamento = false;

        // URL do repert√≥rio online
        const REPERTORIO_URL = "https://jecwb.github.io/bluevox/repertorio.xml";

        // INICIAR APLICA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéµ Repert√≥rio BlueVox iniciado');
            
            // Configurar PWA
            configurarPWA();
            
            // Carregar configura√ß√µes salvas
            carregarConfiguracoes();
            
            // Carregar m√∫sicas salvas
            const musicasSalvas = localStorage.getItem('catalogoMusicas');
            if (musicasSalvas) {
                try {
                    musicas = JSON.parse(musicasSalvas);
                    if (musicas.length > 0) {
                        mostrarInterfaceComMusicas();
                    }
                } catch (e) {
                    console.error('Erro ao carregar m√∫sicas:', e);
                    musicas = [];
                }
            }

            // Configurar eventos GLOBAIS
            configurarEventosGlobais();
            
            // Verificar se h√° atualiza√ß√µes dispon√≠veis
            verificarAtualizacoes();
        });

        // FUN√á√ÉO PRINCIPAL DE FORMATA√á√ÉO - CORRIGIDA
        function formatarLetra(texto) {
            const linhas = texto.split('\n');
            let html = '';
            
            linhas.forEach(linha => {
                linha = linha.trim();
                if (!linha) {
                    html += '<br>';
                    return;
                }
                
                // Processar texto entre || para mostrar entre [] na cor laranja
                let linhaFormatada = processarBarrasLaranja(linha);
                
                if (linha.toUpperCase().startsWith('[R]')) {
                    const linhaSemR = linha.substring(3).trim();
                    linhaFormatada = processarBarrasLaranja(linhaSemR);
                    html += `<div class="yellow-line">${linhaFormatada.toUpperCase()}</div>`;
                } else {
                    html += `<div class="normal-line">${linhaFormatada.toUpperCase()}</div>`;
                }
            });
            
            return html;
        }

        // FUN√á√ÉO CORRIGIDA PARA PROCESSAR BARRAS LARANJA
        function processarBarrasLaranja(texto) {
            console.log('Processando texto:', texto);
            
            // Express√£o regular para encontrar texto entre ||
            const regex = /\|([^|]+)\|/g;
            
            // Substituir cada ocorr√™ncia
            const resultado = texto.replace(regex, function(match, conteudo) {
                console.log('Encontrado:', match, 'Conte√∫do:', conteudo);
                return `<span class="laranja">[${conteudo}]</span>`;
            });
            
            console.log('Resultado:', resultado);
            return resultado;
        }

        // TESTE R√ÅPIDO - Vamos adicionar uma m√∫sica de teste automaticamente
        function adicionarMusicaTeste() {
            const musicaTeste = {
                nome: "M√öSICA TESTE LARANJA",
                letra: `[R] ESTA √â UMA M√öSICA DE TESTE
[R] PARA VERIFICAR A COR LARANJA

VAMOS TESTAR A COR LARANJA:
Um homem |Bm| dan√ßava no ch√£o
E uma mulher |G| cantava uma can√ß√£o
No acorde |C| todos se alegravam
E no |F| a festa continuava

OUTRO EXEMPLO:
|Intro| |Verso| |Refr√£o| |Final|

ISSO DEVE APARECER EM LARANJA!`,
                dataCriacao: new Date().toISOString()
            };

            musicas.push(musicaTeste);
            salvarMusicas();
            exibirListaMusicas();
            mostrarInterfaceComMusicas();
            
            // Abrir a m√∫sica de teste automaticamente
            setTimeout(() => {
                abrirMusica(musicas.length - 1);
            }, 500);
        }

        // DEMONSTRA√á√ÉO - Adicionar bot√£o de teste
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar bot√£o de teste ap√≥s o carregamento
            setTimeout(() => {
                const emptyState = document.getElementById('empty-state');
                if (emptyState) {
                    const testButton = document.createElement('button');
                    testButton.className = 'btn';
                    testButton.style.marginTop = '10px';
                    testButton.style.backgroundColor = '#663300';
                    testButton.innerHTML = 'üß™ TESTAR COR LARANJA';
                    testButton.onclick = adicionarMusicaTeste;
                    emptyState.querySelector('.backup-options').appendChild(testButton);
                }
            }, 1000);
        });

        // ... (o restante do c√≥digo permanece igual - fun√ß√µes de PWA, configura√ß√µes, controles, etc.)

        // CONFIGURAR PWA
        function configurarPWA() {
            // ... (c√≥digo PWA existente)
        }

        function verificarInstalabilidade() {
            // ... (c√≥digo existente)
        }

        function instalarApp() {
            // ... (c√≥digo existente)
        }

        // CONFIGURA√á√ïES DE CORES
        function carregarConfiguracoes() {
            const temaSalvo = localStorage.getItem('temaRepertorio') || 'green';
            aplicarTema(temaSalvo);
        }

        function mostrarConfiguracoes() {
            document.getElementById('config-modal').style.display = 'block';
            const temaAtual = localStorage.getItem('temaRepertorio') || 'green';
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === temaAtual) {
                    option.classList.add('active');
                }
            });
        }

        function fecharConfigModal() {
            document.getElementById('config-modal').style.display = 'none';
        }

        function aplicarTema(tema) {
            const temas = {
                green: { primaria: '#00ff00', secundaria: '#00aa00', fundo: '#000000', texto: '#00ff00', destaque: '#ffff00', laranja: '#ff8800' },
                blue: { primaria: '#0088ff', secundaria: '#0066cc', fundo: '#000033', texto: '#0088ff', destaque: '#00ffff', laranja: '#ff8800' },
                red: { primaria: '#ff4444', secundaria: '#cc0000', fundo: '#330000', texto: '#ff4444', destaque: '#ff8888', laranja: '#ff8800' },
                purple: { primaria: '#cc00ff', secundaria: '#9900cc', fundo: '#1a001a', texto: '#cc00ff', destaque: '#ff88ff', laranja: '#ff8800' },
                orange: { primaria: '#ff8800', secundaria: '#cc6600', fundo: '#331900', texto: '#ff8800', destaque: '#ffcc00', laranja: '#ffaa00' }
            };
            
            const cores = temas[tema];
            const root = document.documentElement;
            
            root.style.setProperty('--cor-primaria', cores.primaria);
            root.style.setProperty('--cor-secundaria', cores.secundaria);
            root.style.setProperty('--cor-fundo', cores.fundo);
            root.style.setProperty('--cor-texto', cores.texto);
            root.style.setProperty('--cor-destaque', cores.destaque);
            root.style.setProperty('--cor-laranja', cores.laranja);
            
            document.querySelector('meta[name="theme-color"]').setAttribute('content', cores.primaria);
            localStorage.setItem('temaRepertorio', tema);
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`[data-theme="${tema}"]`).classList.add('active');
        }

        function resetarTema() {
            aplicarTema('green');
        }

        // ... (as demais fun√ß√µes permanecem iguais: controles, eventos, backup, importa√ß√£o, update, etc.)

        // FUN√á√ïES PRINCIPAIS DA APLICA√á√ÉO
        function mostrarInterfaceComMusicas() {
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('music-list').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            document.getElementById('music-count').style.display = 'block';
            exibirListaMusicas();
        }

        function exibirListaMusicas() {
            const lista = document.getElementById('music-list');
            
            if (musicas.length === 0) {
                document.getElementById('empty-state').style.display = 'block';
                document.getElementById('music-list').style.display = 'none';
                document.getElementById('controls').style.display = 'none';
                document.getElementById('music-count').style.display = 'none';
                return;
            }
            
            musicas.sort((a, b) => a.nome.localeCompare(b.nome));
            
            lista.innerHTML = musicas.map((musica, index) => `
                <div class="music-item" onclick="abrirMusica(${index})">
                    <div class="music-name">${musica.nome}</div>
                    <div class="music-actions">
                        <button class="action-btn edit-btn" onclick="event.stopPropagation(); editarMusicaForm(${index})" title="Editar m√∫sica">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" onclick="event.stopPropagation(); removerMusica(${index})" title="Remover m√∫sica">√ó</button>
                    </div>
                </div>
            `).join('');
            
            atualizarContador();
        }

        function atualizarContador() {
            const countElement = document.getElementById('music-count');
            const total = musicas.length;
            countElement.textContent = `${total} m√∫sica${total !== 1 ? 's' : ''} no repert√≥rio`;
        }

        function salvarMusicas() {
            localStorage.setItem('catalogoMusicas', JSON.stringify(musicas));
            atualizarContador();
        }

        function mostrarFormulario() {
            document.getElementById('add-form').reset();
            document.getElementById('add-modal').style.display = 'block';
            setTimeout(() => document.getElementById('nome-musica').focus(), 100);
        }

        function fecharAddModal() {
            document.getElementById('add-modal').style.display = 'none';
        }

        function adicionarMusica(event) {
            event.preventDefault();
            const nome = document.getElementById('nome-musica').value.trim();
            const letra = document.getElementById('letra-musica').value;

            if (!nome || !letra.trim()) {
                alert('‚ùå Preencha todos os campos!');
                return;
            }

            if (musicas.some(m => m.nome.toUpperCase() === nome.toUpperCase())) {
                alert('‚ùå J√° existe uma m√∫sica com este nome!');
                return;
            }

            const novaMusica = {
                nome: nome.toUpperCase(),
                letra: letra,
                dataCriacao: new Date().toISOString()
            };

            musicas.push(novaMusica);
            salvarMusicas();

            if (musicas.length === 1) {
                mostrarInterfaceComMusicas();
            } else {
                exibirListaMusicas();
            }

            fecharAddModal();
        }

        function editarMusicaForm(index) {
            const musica = musicas[index];
            document.getElementById('edit-index').value = index;
            document.getElementById('edit-nome-musica').value = musica.nome;
            document.getElementById('edit-letra-musica').value = musica.letra;
            document.getElementById('edit-modal').style.display = 'block';
            setTimeout(() => document.getElementById('edit-nome-musica').focus(), 100);
        }

        function fecharEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function editarMusica(event) {
            event.preventDefault();
            const index = document.getElementById('edit-index').value;
            const nome = document.getElementById('edit-nome-musica').value.trim();
            const letra = document.getElementById('edit-letra-musica').value;

            if (!nome || !letra.trim()) {
                alert('‚ùå Preencha todos os campos!');
                return;
            }

            const nomeExistente = musicas.some((m, i) => 
                i != index && m.nome.toUpperCase() === nome.toUpperCase()
            );

            if (nomeExistente) {
                alert('‚ùå J√° existe uma m√∫sica com este nome!');
                return;
            }

            musicas[index] = {
                ...musicas[index],
                nome: nome.toUpperCase(),
                letra: letra,
                dataModificacao: new Date().toISOString()
            };

            salvarMusicas();
            exibirListaMusicas();
            fecharEditModal();
        }

        function removerMusica(index) {
            const nomeMusica = musicas[index].nome;
            if (confirm(`Tem certeza que deseja remover "${nomeMusica}"?`)) {
                musicas.splice(index, 1);
                salvarMusicas();
                exibirListaMusicas();
            }
        }

        function abrirMusica(index) {
            const musica = musicas[index];
            document.getElementById('modal-title').textContent = musica.nome;
            document.getElementById('lyrics-content').innerHTML = formatarLetra(musica.letra);
            document.getElementById('music-modal').style.display = 'block';
            
            autoScrollAtivo = false;
            pararAutoScroll();
            const scrollToggle = document.getElementById('scroll-toggle');
            if (scrollToggle) {
                scrollToggle.classList.remove('active');
                scrollToggle.innerHTML = '‚ñ∂Ô∏è Scroll';
            }
            const speedControls = document.getElementById('speed-controls');
            if (speedControls) speedControls.style.display = 'none';
            
            setTimeout(() => {
                configurarEventosModal();
                document.querySelector('.modal-body').scrollTop = 0;
                ajustarFonteAuto();
            }, 100);
        }

        function fecharModal() {
            if (autoScrollAtivo) {
                pararAutoScroll();
                autoScrollAtivo = false;
            }
            document.getElementById('music-modal').style.display = 'none';
        }

        // ... (restante das fun√ß√µes: eventos, controles, backup, importa√ß√£o, update, etc.)

        // CONTROLES DE FONTE E SCROLL
        function ajustarFonte(mudanca) {
            const elemento = document.getElementById('lyrics-content');
            if (!elemento) return;
            
            let tamanhoAtual = parseFloat(getComputedStyle(elemento).fontSize);
            
            if (mudanca === 0) {
                elemento.style.fontSize = tamanhoFonteBase + 'px';
            } else {
                const novoTamanho = Math.max(10, Math.min(30, tamanhoAtual + mudanca));
                elemento.style.fontSize = novoTamanho + 'px';
                
                if (novoTamanho > 24) {
                    ajustarFonteAuto();
                }
            }
        }

        function ajustarFonteAuto() {
            const elemento = document.getElementById('lyrics-content');
            if (!elemento) return;
            
            const texto = elemento.textContent;
            const linhas = texto.split('\n');
            const linhaMaisLonga = linhas.reduce((maisLonga, linha) => 
                linha.length > maisLonga.length ? linha : maisLonga, '');
            
            const larguraDisponivel = elemento.clientWidth - 40;
            const tamanhoIdeal = Math.max(12, Math.min(24, Math.floor(larguraDisponivel / (linhaMaisLonga.length * 0.6))));
            
            elemento.style.fontSize = tamanhoIdeal + 'px';
            tamanhoFonteBase = tamanhoIdeal;
        }

        function toggleAutoScroll() {
            autoScrollAtivo = !autoScrollAtivo;
            const botao = document.getElementById('scroll-toggle');
            const controlesVelocidade = document.getElementById('speed-controls');
            
            if (!botao) return;
            
            if (autoScrollAtivo) {
                botao.classList.add('active');
                botao.innerHTML = '‚è≥ Scroll';
                controlesVelocidade.style.display = 'flex';
                iniciarAutoScroll();
            } else {
                botao.classList.remove('active');
                botao.innerHTML = '‚ñ∂Ô∏è Scroll';
                controlesVelocidade.style.display = 'none';
                pararAutoScroll();
            }
        }

        function setScrollSpeed(velocidade) {
            scrollSpeed = velocidade;
            
            document.querySelectorAll('.speed-btn').forEach((btn, index) => {
                if (index + 1 === velocidade) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            if (autoScrollAtivo) {
                pararAutoScroll();
                iniciarAutoScroll();
            }
        }

        function iniciarAutoScroll() {
            const lyricsContent = document.getElementById('lyrics-content');
            const modalBody = document.querySelector('.modal-body');
            
            if (!lyricsContent || !modalBody) return;
            
            if (modalBody.scrollTop >= lyricsContent.scrollHeight - modalBody.clientHeight) {
                modalBody.scrollTop = 0;
            }
            
            const velocidades = {
                1: 0.3, 2: 0.6, 3: 1, 4: 1.5, 5: 2, 6: 3, 7: 4
            };
            
            pararAutoScroll();
            
            setTimeout(() => {
                scrollInterval = setInterval(() => {
                    const currentScroll = modalBody.scrollTop;
                    const maxScroll = lyricsContent.scrollHeight - modalBody.clientHeight;
                    
                    if (currentScroll >= maxScroll) {
                        pararAutoScroll();
                        autoScrollAtivo = false;
                        const scrollToggle = document.getElementById('scroll-toggle');
                        if (scrollToggle) {
                            scrollToggle.classList.remove('active');
                            scrollToggle.innerHTML = '‚ñ∂Ô∏è Scroll';
                        }
                        const speedControls = document.getElementById('speed-controls');
                        if (speedControls) speedControls.style.display = 'none';
                        return;
                    }
                    
                    modalBody.scrollTop += velocidades[scrollSpeed];
                    
                }, 16);
            }, 10000);
        }

        function pararAutoScroll() {
            if (scrollInterval) {
                clearInterval(scrollInterval);
                scrollInterval = null;
            }
        }

        // EVENTOS GLOBAIS
        function configurarEventosGlobais() {
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    fecharModal();
                    fecharAddModal();
                    fecharEditModal();
                    fecharConfigModal();
                    fecharImportModal();
                    fecharImportURLModal();
                    fecharUpdateModal();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    fecharModal();
                    fecharAddModal();
                    fecharEditModal();
                    fecharConfigModal();
                    fecharImportModal();
                    fecharImportURLModal();
                    fecharUpdateModal();
                }
            });

            if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                document.documentElement.requestFullscreen?.();
            }
        }

        function configurarEventosModal() {
            const modalBody = document.querySelector('.modal-body');
            if (modalBody) {
                modalBody.replaceWith(modalBody.cloneNode(true));
                
                const novoModalBody = document.querySelector('.modal-body');
                
                novoModalBody.addEventListener('wheel', () => {
                    if (autoScrollAtivo) {
                        toggleAutoScroll();
                    }
                });

                novoModalBody.addEventListener('touchstart', () => {
                    if (autoScrollAtivo) {
                        toggleAutoScroll();
                    }
                });

                novoModalBody.addEventListener('scroll', () => {
                    if (autoScrollAtivo) {
                        const lyricsContent = document.getElementById('lyrics-content');
                        const maxScroll = lyricsContent.scrollHeight - novoModalBody.clientHeight;
                        
                        if (novoModalBody.scrollTop >= maxScroll - 10) {
                            toggleAutoScroll();
                        }
                    }
                });
            }
        }

        // ... (restante das fun√ß√µes: exportarDados, importa√ß√£o, update, etc.)

        // FUN√á√ïES DE BACKUP
        function exportarDados() {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<repertorio>\n';
            xml += `  <info>\n`;
            xml += `    <aplicacao>Repert√≥rio BlueVox</aplicacao>\n`;
            xml += `    <versao>1.0</versao>\n`;
            xml += `    <dataExportacao>${new Date().toISOString()}</dataExportacao>\n`;
            xml += `    <totalMusicas>${musicas.length}</totalMusicas>\n`;
            xml += `  </info>\n`;
            xml += `  <musicas>\n`;
            
            musicas.forEach(musica => {
                xml += `    <musica>\n`;
                xml += `      <nome><![CDATA[${musica.nome}]]></nome>\n`;
                xml += `      <letra><![CDATA[${musica.letra}]]></letra>\n`;
                xml += `      <dataCriacao>${musica.dataCriacao || ''}</dataCriacao>\n`;
                if (musica.dataModificacao) {
                    xml += `      <dataModificacao>${musica.dataModificacao}</dataModificacao>\n`;
                }
                xml += `    </musica>\n`;
            });
            
            xml += `  </musicas>\n`;
            xml += `</repertorio>`;
            
            const blob = new Blob([xml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `repertorio-bluevox-${new Date().toISOString().split('T')[0]}.xml`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`üì§ Backup XML exportado com sucesso!\n${musicas.length} m√∫sica(s) salvas.`);
        }

        // ... (fun√ß√µes de importa√ß√£o, update, etc. - mantidas iguais)

        // FUN√á√ïES DE UPDATE DO REPERT√ìRIO
        async function verificarAtualizacoes() {
            try {
                console.log('üîÑ Verificando atualiza√ß√µes do repert√≥rio...');
                
                const response = await fetch(REPERTORIO_URL);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                
                if (xmlDoc.getElementsByTagName("parsererror").length > 0) {
                    throw new Error('XML malformado ou inv√°lido');
                }
                
                const musicasNodes = xmlDoc.querySelectorAll('musica');
                const musicasOnline = [];
                
                musicasNodes.forEach(musicaNode => {
                    const nome = musicaNode.querySelector('nome')?.textContent || '';
                    const letra = musicaNode.querySelector('letra')?.textContent || '';
                    
                    if (nome && letra) {
                        musicasOnline.push({
                            nome: nome,
                            letra: letra
                        });
                    }
                });
                
                if (musicasOnline.length === 0) {
                    throw new Error('Nenhuma m√∫sica v√°lida encontrada no repert√≥rio online');
                }
                
                const hashOnline = calcularHash(musicasOnline);
                const hashSalvo = localStorage.getItem('repertorioHash');
                
                console.log('üîç Hash do repert√≥rio online:', hashOnline);
                console.log('üîç Hash do repert√≥rio salvo:', hashSalvo);
                
                if (!hashSalvo || hashSalvo !== hashOnline) {
                    console.log('üÜï Atualiza√ß√£o dispon√≠vel!');
                    localStorage.setItem('repertorioOnline', JSON.stringify(musicasOnline));
                    mostrarAlertaAtualizacao();
                } else {
                    console.log('‚úÖ Repert√≥rio est√° atualizado');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao verificar atualiza√ß√µes:', error);
            }
        }

        function calcularHash(musicasArray) {
            const dados = musicasArray.map(m => `${m.nome}${m.letra}`).join('');
            let hash = 0;
            for (let i = 0; i < dados.length; i++) {
                const char = dados.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        function mostrarAlertaAtualizacao() {
            const alertElement = document.getElementById('update-alert');
            if (alertElement) {
                alertElement.style.display = 'block';
            }
        }

        function mostrarOpcoesUpdate() {
            const musicasOnlineSalvas = localStorage.getItem('repertorioOnline');
            let musicasOnline = [];
            
            if (musicasOnlineSalvas) {
                try {
                    musicasOnline = JSON.parse(musicasOnlineSalvas);
                } catch (e) {
                    console.error('Erro ao carregar repert√≥rio online salvo:', e);
                }
            }
            
            if (musicasOnline.length === 0) {
                buscarRepertorioOnline();
                return;
            }
            
            document.getElementById('update-count').textContent = musicasOnline.length;
            document.getElementById('update-modal').style.display = 'block';
            
            document.querySelectorAll('.import-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('confirm-update-btn').disabled = true;
        }

        async function buscarRepertorioOnline() {
            try {
                console.log('üåê Buscando repert√≥rio online...');
                
                const response = await fetch(REPERTORIO_URL);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                
                if (xmlDoc.getElementsByTagName("parsererror").length > 0) {
                    throw new Error('XML malformado ou inv√°lido');
                }
                
                const musicasNodes = xmlDoc.querySelectorAll('musica');
                const musicasOnline = [];
                
                musicasNodes.forEach(musicaNode => {
                    const nome = musicaNode.querySelector('nome')?.textContent || '';
                    const letra = musicaNode.querySelector('letra')?.textContent || '';
                    
                    if (nome && letra) {
                        musicasOnline.push({
                            nome: nome,
                            letra: letra
                        });
                    }
                });
                
                if (musicasOnline.length === 0) {
                    throw new Error('Nenhuma m√∫sica v√°lida encontrada no repert√≥rio online');
                }
                
                localStorage.setItem('repertorioOnline', JSON.stringify(musicasOnline));
                
                document.getElementById('update-count').textContent = musicasOnline.length;
                document.getElementById('update-modal').style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar repert√≥rio online:', error);
                alert(`‚ùå Erro ao buscar repert√≥rio online:\n${error.message}`);
            }
        }

        function fecharUpdateModal() {
            document.getElementById('update-modal').style.display = 'none';
        }

        function selecionarOpcaoUpdate(opcao) {
            document.querySelectorAll('.import-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(`update-option-${opcao}`).classList.add('selected');
            
            document.getElementById('confirm-update-btn').disabled = false;
        }

        function confirmarUpdate() {
            const opcaoSelecionada = document.querySelector('#update-modal .import-option.selected');
            if (!opcaoSelecionada) {
                alert('‚ùå Selecione uma op√ß√£o de update.');
                return;
            }
            
            const opcao = opcaoSelecionada.id.replace('update-option-', '');
            const musicasOnlineSalvas = localStorage.getItem('repertorioOnline');
            
            if (!musicasOnlineSalvas) {
                alert('‚ùå Dados do repert√≥rio online n√£o encontrados. Tente novamente.');
                return;
            }
            
            try {
                const musicasOnline = JSON.parse(musicasOnlineSalvas);
                let mensagem = '';
                let musicasAdicionadas = 0;
                let musicasAtualizadas = 0;

                switch (opcao) {
                    case 'substituir':
                        musicas = musicasOnline;
                        mensagem = `‚úÖ Repert√≥rio atualizado! ${musicas.length} m√∫sica(s) carregadas.`;
                        break;
                        
                    case 'mesclar':
                        const mapaMusicas = new Map();
                        
                        musicas.forEach(musica => {
                            mapaMusicas.set(musica.nome.toUpperCase(), musica);
                        });
                        
                        musicasOnline.forEach(musicaOnline => {
                            const chave = musicaOnline.nome.toUpperCase();
                            if (mapaMusicas.has(chave)) {
                                mapaMusicas.set(chave, {
                                    ...mapaMusicas.get(chave),
                                    letra: musicaOnline.letra,
                                    dataModificacao: new Date().toISOString()
                                });
                                musicasAtualizadas++;
                            } else {
                                mapaMusicas.set(chave, musicaOnline);
                                musicasAdicionadas++;
                            }
                        });
                        
                        musicas = Array.from(mapaMusicas.values());
                        mensagem = `‚úÖ Repert√≥rio mesclado! ${musicasAdicionadas} nova(s) m√∫sica(s) adicionadas e ${musicasAtualizadas} m√∫sica(s) atualizadas.`;
                        break;
                }

                const hashOnline = calcularHash(musicasOnline);
                localStorage.setItem('repertorioHash', hashOnline);
                
                document.getElementById('update-alert').style.display = 'none';
                
                salvarMusicas();
                exibirListaMusicas();
                
                if (musicas.length > 0) {
                    mostrarInterfaceComMusicas();
                }

                const lista = document.getElementById('music-list');
                const successMsg = document.createElement('div');
                successMsg.className = 'success';
                successMsg.innerHTML = mensagem;
                lista.insertBefore(successMsg, lista.firstChild);
                setTimeout(() => successMsg.remove(), 5000);

                fecharUpdateModal();
                
            } catch (error) {
                console.error('Erro ao processar update:', error);
                alert(`‚ùå Erro ao processar update:\n${error.message}`);
            }
        }

        // FUN√á√ÉO PARA RESETAR O APLICATIVO
        function resetarAplicativo() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nIsso ir√° apagar TODOS os dados do aplicativo, incluindo:\n\n‚Ä¢ Todas as m√∫sicas do repert√≥rio\n‚Ä¢ Configura√ß√µes salvas\n‚Ä¢ Hist√≥rico de atualiza√ß√µes\n\nTem certeza que deseja resetar o aplicativo?')) {
                localStorage.clear();
                alert('‚úÖ Aplicativo resetado com sucesso!\n\nA p√°gina ser√° recarregada.');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        function mostrarAjuda() {
            alert(`üéµ AJUDA - REPERT√ìRIO BLUEVOX

üëÅÔ∏è VISUALIZAR M√öSICA:
‚Ä¢ A- A A+ = Controles de tamanho da fonte
‚Ä¢ ‚ñ∂Ô∏è Scroll = Auto scroll autom√°tico (inicia ap√≥s 10 segundos)
‚Ä¢ üêåüê¢üê¢üö∂üê¢üèÉ‚ö° = 7 velocidades de scroll (4 lentas, 3 r√°pidas)

‚ûï ADICIONAR M√öSICA:
‚Ä¢ Clique em "Adicionar M√∫sica"
‚Ä¢ Digite o nome e cole a letra
‚Ä¢ Use [R] para linhas em AMARELO
‚Ä¢ Use |Bm| para mostrar [Bm] em LARANJA

‚úèÔ∏è EDITAR M√öSICA:
‚Ä¢ Clique no √≠cone ‚úèÔ∏è ao lado da m√∫sica
‚Ä¢ Altere o nome e/ou letra
‚Ä¢ Salve as altera√ß√µes

üóëÔ∏è REMOVER M√öSICA:
‚Ä¢ Clique no √ó vermelho ao lado da m√∫sica

üí° Use |texto| para mostrar [texto] em LARANJA!`);
        }

        // ... (fun√ß√µes de importa√ß√£o via URL e arquivo - mantidas iguais)
    </script>
</body>
</html>
